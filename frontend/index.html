<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cartshoe POS</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .product { display: inline-block; width: 180px; margin: 10px; vertical-align: top; }
    .product img { width: 100%; height: auto; }
    .product h3 { margin: 5px 0; }
    #cart { margin-top: 30px; }
  </style>
</head>
<body>
  <h1>Cartshoe POS</h1>
  <div id="products"></div>
  <h2>Cart</h2>
  <div id="cart"></div>
  <button onclick="checkout()">Checkout</button>

  <script>
    function loadProducts() {
      fetch('/products')
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('products');
          container.innerHTML = '';
          data.products.forEach(p => {
            const div = document.createElement('div');
            div.className = 'product';
            div.innerHTML = `
              <img src="${p.image}" alt="${p.name}" />
              <h3>${p.name}</h3>
              <div>$${p.price.toFixed(2)}</div>
              <input type="number" id="qty-${p.id}" value="1" min="1" />
              <button onclick="addToCart(${p.id})">Add to cart</button>
            `;
            container.appendChild(div);
          });
        });
    }

    function addToCart(id) {
      const qty = parseInt(document.getElementById(`qty-${id}`).value);
      fetch('/add_to_cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, qty })
      })
      .then(res => {
        if (!res.ok) throw new Error(res.statusText);
        return res.text();
      })
      .then(() => loadCart())
      .catch(err => alert(err));
    }

    function loadCart() {
      fetch('/cart')
        .then(res => res.json())
        .then(data => {
          const c = document.getElementById('cart');
          c.innerHTML = '';
          data.cart.forEach(item => {
            const div = document.createElement('div');
            div.textContent = `${item.name} - $${item.price.toFixed(2)}`;
            c.appendChild(div);
          });
          c.innerHTML += `<strong>Total: $${data.total.toFixed(2)}</strong>`;
        });
    }

    function checkout() {
      fetch('/checkout', { method: 'POST' })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          loadCart();
        });
    }

    window.onload = () => {
      loadProducts();
      loadCart();
    };
  </script>
</body>
</html>
